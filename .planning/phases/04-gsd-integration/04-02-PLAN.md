---
phase: 04-gsd-integration
plan: 02
type: execute
wave: 2
depends_on: [04-01]
files_modified: [src/rlm/cli/rlm-cli.ts, src/rlm/cli/index.ts, bin/install.js, package.json]
autonomous: true
---

<objective>
Create standalone RLM CLI tool and integrate into GSD install process.

Purpose: Enable users to index their codebase and test queries without a full GSD workflow. The CLI also validates that the RLM system works correctly before hooks are wired up.

Output: `rlm` CLI command available after `npm run build:rlm`, integrated into GSD install.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-gsd-integration/04-RESEARCH.md
@.planning/phases/04-gsd-integration/04-01-PLAN.md

Relevant source files:
@bin/install.js
@package.json
@src/rlm/index.ts
@src/rlm/indexing/indexer.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RLM CLI tool</name>
  <files>src/rlm/cli/rlm-cli.ts</files>
  <action>
Create src/rlm/cli/rlm-cli.ts with a minimal CLI for indexing and querying:

1. Parse commands: index, query, status
   - Use process.argv (no external CLI library needed)

2. Command: index [path]
   - Default path: current directory
   - Use indexDirectory from '../indexing/index.js'
   - Print progress: "Indexing {path}..."
   - Print result: "Indexed {n} chunks in {time}ms"

3. Command: query <text>
   - Use quickRetrieve from '../integration/index.js'
   - Use formatChunksAsContext from '../integration/index.js'
   - Print formatted context to stdout
   - On no results: "No relevant chunks found"

4. Command: status
   - Check if Qdrant is reachable (createQdrantClient from storage)
   - Check if collection exists
   - Print: "Qdrant: {connected|disconnected}"
   - Print: "Collection: {exists|not found}"
   - Print: "Chunks indexed: {count}"

5. Error handling:
   - Wrap all commands in try/catch
   - Print user-friendly errors to stderr
   - Exit with code 1 on failure

Include shebang: #!/usr/bin/env node

Keep CLI minimal - this is for validation, not full UX.
  </action>
  <verify>npm run build:rlm compiles without errors</verify>
  <done>RLM CLI exists with index, query, status commands</done>
</task>

<task type="auto">
  <name>Task 2: Create CLI index and update package.json</name>
  <files>src/rlm/cli/index.ts, package.json</files>
  <action>
1. Create src/rlm/cli/index.ts:
   - Re-export main from './rlm-cli.js' (for programmatic use)
   - This is primarily for the bin entry

2. Update package.json:
   - Add to "bin" section:
     ```json
     "rlm": "dist/rlm/cli/rlm-cli.js"
     ```
   - Add "dist" to "files" array (for built JS)

3. Ensure tsconfig.json outputs to dist/ (should already be configured)

The CLI should work via:
- `npm run build:rlm && node dist/rlm/cli/rlm-cli.js index .`
- After npm link: `rlm index .`
  </action>
  <verify>npm run build:rlm compiles; dist/rlm/cli/rlm-cli.js exists</verify>
  <done>CLI accessible via package.json bin entry</done>
</task>

<task type="auto">
  <name>Task 3: Add RLM build step to install.js</name>
  <files>bin/install.js</files>
  <action>
Add RLM distribution to install process:

1. After copying hooks, add step to copy RLM dist if it exists:
   ```javascript
   // Copy RLM distribution (if built)
   const rlmDistSrc = path.join(src, 'dist', 'rlm');
   if (fs.existsSync(rlmDistSrc)) {
     const rlmDistDest = path.join(claudeDir, 'rlm');
     copyDir(rlmDistSrc, rlmDistDest);
     console.log(`  ${green}âœ“${reset} Installed RLM modules`);
   }
   ```

2. Add helper function copyDir (simple recursive copy):
   ```javascript
   function copyDir(src, dest) {
     fs.mkdirSync(dest, { recursive: true });
     for (const entry of fs.readdirSync(src, { withFileTypes: true })) {
       const srcPath = path.join(src, entry.name);
       const destPath = path.join(dest, entry.name);
       if (entry.isDirectory()) {
         copyDir(srcPath, destPath);
       } else {
         fs.copyFileSync(srcPath, destPath);
       }
     }
   }
   ```

3. RLM is optional - install succeeds even without built RLM
   - Users without RLM just don't get the features
   - No failure tracking for RLM (graceful degradation)

This ensures GSD install includes RLM when available without breaking existing installs.
  </action>
  <verify>npm run build:rlm && node bin/install.js --local succeeds</verify>
  <done>Install process copies RLM dist when available</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build:rlm` succeeds without errors
- [ ] `node dist/rlm/cli/rlm-cli.js status` runs (may show disconnected if no Qdrant)
- [ ] `node dist/rlm/cli/rlm-cli.js --help` or invalid command shows usage
- [ ] package.json has "rlm" bin entry pointing to dist/rlm/cli/rlm-cli.js
- [ ] bin/install.js copies RLM dist when present
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- CLI provides index, query, status commands
- Install process handles RLM gracefully (optional component)
</success_criteria>

<output>
After completion, create `.planning/phases/04-gsd-integration/04-02-SUMMARY.md`
</output>
