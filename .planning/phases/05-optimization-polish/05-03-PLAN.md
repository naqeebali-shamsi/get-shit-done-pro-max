---
phase: 05-optimization-polish
plan: 03
type: execute
wave: 2
depends_on: ["05-01", "05-02"]
files_modified: [src/rlm/storage/qdrant-client.ts, src/rlm/retrieval/hybrid-search.ts, src/rlm/integration/quick-retrieve.ts, docs/CONTRIBUTING.md]
autonomous: true
---

<objective>
Implement graceful degradation for Qdrant unavailability, add Qdrant scalar quantization for latency optimization, and verify <500ms retrieval target is met.

Purpose:
- OPT-03 reframed as "graceful degradation" (research finding: Qdrant quantized matches FAISS, skip FAISS)
- OPT-04: Verify <500ms latency with cache + quantization
- QUA-02: Validate retrieval precision >0.8
- QUA-03: Create contributor documentation

Output: Production-ready RLM system with graceful failure handling, optimized latency, and documented contribution guidelines.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-optimization-polish/05-RESEARCH.md
@.planning/phases/05-optimization-polish/05-01-SUMMARY.md
@.planning/phases/05-optimization-polish/05-02-SUMMARY.md
@src/rlm/storage/qdrant-client.ts
@src/rlm/retrieval/hybrid-search.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Qdrant scalar quantization configuration</name>
  <files>src/rlm/storage/qdrant-client.ts</files>
  <action>
Update ensureCollection() to optionally enable scalar quantization:
1. Add quantization option to CollectionConfig type: { enabled: boolean, type: 'int8', always_ram: boolean }
2. When creating collection, add quantization_config if enabled:
   ```
   quantization_config: {
     scalar: {
       type: 'int8',
       quantile: 0.99,
       always_ram: true  // Critical for latency
     }
   }
   ```
3. Default quantization to disabled (backward compatible)
4. Add function enableQuantization(collectionName) for existing collections

Research finding: Scalar int8 gives 4x memory reduction with <10% latency increase. always_ram=true is critical for sub-500ms latency.
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>ensureCollection accepts quantization config, enableQuantization function available</done>
</task>

<task type="auto">
  <name>Task 2: Enhance graceful degradation in retrieval</name>
  <files>src/rlm/retrieval/hybrid-search.ts, src/rlm/integration/quick-retrieve.ts</files>
  <action>
Improve error handling to gracefully degrade when Qdrant unavailable:

1. In hybridSearch:
   - Wrap Qdrant calls in try/catch
   - On connection error, return empty results with warning flag
   - Log error but don't throw (caller can check warning)
   - Return type: { results: SearchResult[], warning?: string }

2. In quickRetrieve:
   - Already has try/catch returning []
   - Add logging when Qdrant unavailable
   - Add optional onError callback for monitoring

3. Add timeout to Qdrant operations (5 second default, configurable)

This fulfills OPT-03 without FAISS - system continues working with degraded results when vector DB unavailable.
  </action>
  <verify>npm run build succeeds</verify>
  <done>hybridSearch and quickRetrieve return gracefully when Qdrant unavailable</done>
</task>

<task type="auto">
  <name>Task 3: Create contributor documentation</name>
  <files>docs/CONTRIBUTING.md</files>
  <action>
Create comprehensive contributor documentation covering:

1. Project Overview:
   - What RLM is (Recursive Language Model for codebase understanding)
   - How it integrates with GSD commands

2. Architecture:
   - Module overview: chunking, storage, embedding, retrieval, engine, verification
   - Data flow diagram (text description)
   - Key design decisions from PROJECT.md

3. Development Setup:
   - Prerequisites (Node 18+, Ollama, Qdrant optional)
   - Installation steps
   - Running tests: npm test
   - Running benchmarks: npm run bench

4. Code Style:
   - TypeScript strict mode
   - Zod for runtime validation
   - Programmatic APIs preferred over shell parsing

5. Testing:
   - Unit tests with Vitest
   - Benchmark suite for performance
   - How to add new tests

6. Pull Request Guidelines:
   - Branch naming
   - Commit message format (conventional commits)
   - What to include in PR description

This fulfills QUA-03 (Documentation for contributors).
  </action>
  <verify>docs/CONTRIBUTING.md exists and is readable</verify>
  <done>CONTRIBUTING.md documents architecture, setup, testing, and PR guidelines</done>
</task>

<task type="auto">
  <name>Task 4: Verify latency targets</name>
  <files>src/rlm/benchmarks/retrieval.bench.ts</files>
  <action>
Run benchmark suite and verify OPT-04 latency target (<500ms retrieval):

1. Run: npm run bench
2. Check cached embedding latency (should be <10ms)
3. Check quickRetrieve latency (should be <500ms with warm cache)
4. If latency exceeds target, investigate and document findings

Add benchmark assertions (soft fail with warning if >500ms):
- afterAll hook that checks results against targets
- Log warning if p95 exceeds 500ms, don't fail build

Document baseline numbers in benchmark file comments for future regression tracking.
  </action>
  <verify>npm run bench completes and reports latency metrics</verify>
  <done>Benchmark verifies <500ms retrieval target (with cache), baselines documented</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] npm run bench runs and reports latency metrics
- [ ] docs/CONTRIBUTING.md exists with comprehensive content
- [ ] quickRetrieve returns [] gracefully when Qdrant unavailable (not throws)
- [ ] Quantization configuration available in storage module
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- OPT-03: Graceful degradation when Qdrant unavailable
- OPT-04: <500ms retrieval latency documented in benchmarks
- QUA-02: Retrieval precision trackable via benchmarks
- QUA-03: CONTRIBUTING.md provides complete contributor guide
</success_criteria>

<output>
After completion, create `.planning/phases/05-optimization-polish/05-03-SUMMARY.md`
</output>
